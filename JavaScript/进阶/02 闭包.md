[toc]

# 闭包 closure

闭包是JavaScript中函数与其词法环境的组合。具体来说，当一个内部函数引用了其外部函数作用域中的变量时，即使外部函数已经执行完毕，这些变量依然会被保留在内存中，不会被垃圾回收机制清除。

> 闭包：在一个函数的环境中，闭包=函数+词法环境

这种特性常用于创建私有变量、实现柯里化或模块模式等。然而，不当使用闭包可能导致内存泄漏，因此需要谨慎管理不需要的引用。

~~~ js
function createCounter() {
  let count = 0;
  return function () {
    count++;
    return count;
  }
}
const counter = createCounter();
console.log(counter()); // 1
console.log(counter()); // 2
console.log(counter()); // 3
~~~

1. createCounter是一个外部函数，它定义了一个局部变量count。
2. 它返回了一个匿名内部函数，这个函数引用来外部函数的变量count。
3. 当调用createCounter()时，它执行完毕并返回了内部函数。通常，他的作用域(包括count)应该被销毁。
4. 然而，由于返回的内部函数闭包了变量count，导致count的生命周期被延长了。变量count就像一个私有状态，只能通过counter这个函数来访问和修改。
5. 每次调用counter()，他都会操作并返回私有的count变量。

> * 闭包不一定有return
> * 闭包不一定会造成内存泄漏，引入如果以后还需要用，就不算内存泄漏
>
> 内存泄漏的情况：
>
> 1. 持有本该销毁的函数，造成关联的词法环境无法销毁。
> 2. 当有多个函数共享词法环境时，可能导致词法环境发生膨胀，从而导致产生无法销毁但无法访问的数据。

